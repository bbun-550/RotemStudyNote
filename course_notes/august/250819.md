250819


#### 전날 리뷰
- 집단 2개 이하일 경우, t-test를 고려한다.
- 평균의 차이를 구해서 분석하는 방법이다.

- one-sample t-test : `stats.ttest_1samp(one_sample, popmean=177.0)`
- 정규성 
- 정규성 위배 시에는 wilcoxon signed-rank test 사용한다
	- `from scipy.stats import wilcoxon`
	- `wilcoxon(data.국어 - 80)`

산술 평균 : np.mean()
가중 평균 : np.average()

---

- 성별(범주형 데이터)에 따라서 탐앤탐스 커피사의 브랜드 만족도(100점 만점, 점수 ; 연속형 데이터)
	- t-test를 사용할 수 있다.
	- or 청소년 성인 노인 ... 으로 범주형으로 나뉜다면 ANOVA를 사용한다.
	- eg. 지역별 수능 점수가 차이가 있다 없다.
		- 중고등학생의 용돈 차이가 있다 없다.

>실습파일
>[[t_test01.py]] : 여아 신생아 몸무게의 평균 검정수행
>[[t_test01_ex.py]] : 단일 집단 t-검정 문제 3개 풀이

>참고 및 정리
>[모수검정과 비모수검정 & 정규성](https://cafe.daum.net/flowlife/SBU0/23?svc=toprank)


## 두 집단의 가설검정

>실습파일
>[[t_test02.py]] : 독립 표본 t-검정
>[[t_test03.py]] : 두 개 데이터 핸들링

#### independent sample t-test 독립 표본 검정
- 두 집단의 평균의 차이 검정
- 서로 다른 두 집단의 평균에 대한 통계 검정에 주로 사용한다.
- 비교를 위해 평균(분자)과 표준편차(분모) 통계량을 사용한다.
- 평균값의 차이가 얼마인지, 표준편차는 얼마나 다른지 확인해서 분석 대상인 두 자료가 같을 가능성의 우연의 범위 5%에 들어가는지 판별한다.
- 평균의 차이$\bar x_{a} - \bar x_{b}$ 나누기 불확실성 $s\sqrt{n}$
	- 평균의 차이가 커지면 t값이 커진다. p값이 작아진다. 그럼 우연의 범위에 들어간다.
	- 불확실성이 커지면 t값이 작아지고, p값이 커진다.
$$
{\bar x_{a} - \bar x_{b}}{s\sqrt{n}}
$$

- 결국 t-test는 두 집단의 평균과 표준편차 *비율*에 대한 대조 검정법이다.

>[!note]
> 추세선 퍼셉트론 RNN attention transformer
> $y=wx+b$ 회귀분석 개념 다음주 예정

#### 두 개의 데이터셋을 입맛에 맞춰 하나(DataFrame)로 만들기(merge)
- 매출액과 날씨 데이터
- 팁 : 각각의 검정 함수에 반드시 1차원 데이터(연봉 컬럼)만 넘겨야 한다.


- paired sample t-test




---

#### 변수의 종류
- 연속변수 : 연속적인 값
	- eg. 나이, 점수, 가격 ...
- 범주변수 :  서로 다른 것으로 구분되는 변수
	- eg. 성별, 예/아니오

- 척도
	- 명목척도
	- 순서척도
	- 

윌콕슨 순위 합 검정 (Wilcoxon rank-sum test)은 두 독립적인 집단 간의 중앙값 차이를 비교하는 비모수 검정 방법이다.

- wilcoxon은 대응표본(짝지어진 자료)에 쓰는 검정이다.
- 남/여는 독립적인 두 집단이므로 순위합 검정 Mann-Whitney U를 써야 한다.

---

## 문제 1
gpt 피드백
아주 잘 풀었어요! 👍
가설 설정 → 정규성 → 등분산성 → 독립 2표본 t-검정까지 **절차가 정확**했고, 계산값과 결론도 타당합니다.

#### 채점

* 가설 설정(양측): ✅
* 정규성 검정(Shapiro): ✅ (해석 표현만 살짝 보완 권장)
* 등분산성 검정(Levene): ✅
* 검정 선택(ttest\_ind, equal\_var=True): ✅
* 결론(p=0.0083 < 0.05 → 귀무가설 기각): ✅
  **총평: A (아주 우수)**

---

#### 미흡/보완 포인트 (현업/논문 스타일)

1. **정규성/등분산성 해석 표현**

* “정규성/등분산성 **만족**” 보다는
  → “정규성/등분산성을 **기각할 충분한 증거가 없다**(p>0.05)” 가 더 정확한 표현입니다.
  (검정의 귀무가설이 각각 “정규성/등분산성 성립”이기 때문)

2. **효과크기와 신뢰구간 제시**

* p-value만으로는 **실질적 크기**를 알기 어렵습니다.
* **평균 차이의 95% 신뢰구간**과 **효과크기(Cohen’s d/ Hedges’ g)** 를 함께 제시하면 논문 품질이 확 올라가요.

3. **시각화로 분포 점검**

* 표본이 작을 때(각 11개) Shapiro의 검정력은 낮습니다.
* **QQ-plot/boxplot**으로 이상치·왜도 여부를 함께 확인하면 좋습니다.

4. **대안 검정 안내**

* 만약 등분산성이 깨졌다면 → `equal_var=False`(Welch t-test)
* 정규성이 의심되면 → **Mann–Whitney U**(비모수) 병행 보고

5. **독립성 가정 명시**

* 두 집단 표본이 **독립적으로 채집**되었다는 전제도 한 줄로 적어두면 완벽.

---

#### 개선 코드 스니펫 (효과크기, CI 포함)

```python
import numpy as np
from scipy import stats

blue = np.array([70,68,82,78,72,68,67,68,88,60,80])
red  = np.array([60,65,55,58,67,59,61,68,77,66,66])

# 1) 기술통계
m1, m2 = blue.mean(), red.mean()
s1, s2 = blue.std(ddof=1), red.std(ddof=1)
n1, n2 = len(blue), len(red)
diff = m1 - m2

# 2) 가정 점검
p_shapiro_blue = stats.shapiro(blue).pvalue
p_shapiro_red  = stats.shapiro(red).pvalue
p_levene = stats.levene(blue, red).pvalue

# 3) t-검정 (등분산 가정 충족)
tstat, pval = stats.ttest_ind(blue, red, equal_var=True)

# 4) 평균차 95% 신뢰구간
sp2 = ((n1-1)*s1**2 + (n2-1)*s2**2) / (n1+n2-2)    # pooled variance
se_diff = np.sqrt(sp2*(1/n1 + 1/n2))
df = n1 + n2 - 2
t_crit = stats.t.ppf(0.975, df)
ci_low, ci_high = diff - t_crit*se_diff, diff + t_crit*se_diff

# 5) 효과크기 (Cohen's d, Hedges' g)
sp = np.sqrt(sp2)
cohen_d = diff / sp
J = 1 - 3/(4*(n1+n2)-9)        # 작은 표본 보정
hedges_g = J * cohen_d

print(f"Means: blue={m1:.2f}, red={m2:.2f}, diff={diff:.2f}")
print(f"Shapiro p: blue={p_shapiro_blue:.4f}, red={p_shapiro_red:.4f}")
print(f"Levene p: {p_levene:.4f}")
print(f"t({df})={tstat:.4f}, p={pval:.4f}")
print(f"95% CI for mean diff: [{ci_low:.2f}, {ci_high:.2f}]")
print(f"Effect size: d={cohen_d:.2f}, g={hedges_g:.2f}")
```

> 위 스니펫을 돌리면, 보고서에 바로 넣을 **평균차 신뢰구간**과 **효과크기**를 얻을 수 있어요.

---

#### 논문식 서술 예시

> **방법** — 포장지 색상(blue vs red)에 따른 매출액 평균 차이를 검증하기 위해 독립 2표본 t-검정을 실시하였다. 사전 검정에서 정규성(Shapiro–Wilk: blue p=0.510, red p=0.535)과 등분산성(Levene p=0.439)을 기각할 충분한 증거가 없어 등분산을 가정하였다.
> **결과** — blue의 평균은 72.82(표준편차 7.88), red의 평균은 63.82(표준편차 5.16)였으며, 두 집단 간 평균 차이는 통계적으로 유의하였다(t(20)=2.928, p=0.008). 평균 차이의 95% 신뢰구간은 \[약 …, …]이었고, 효과크기는 Cohen’s d=…(중간\~큰 효과)였다.
> **해석** — 포장지 색상에 따라 매출액 평균이 유의하게 달랐다. 실무적으로도 무시하기 어려운 효과크기를 보였으며, 색상 전략에 따라 매출 최적화 가능성이 시사된다.

*(CI와 d 값은 스니펫 실행 결과로 채워 넣으세요.)*

---

#### 한 줄 결론

풀이 **정확**했고, 보고서/논문 수준으로는 **신뢰구간 + 효과크기**까지 제시하면 금상첨화입니다.

---

## 문제 2 피드백

아주 잘 접근했어요—샘플링 → 정규성(Shapiro) → 등분산(Levene) → 검정으로 가는 흐름은 훌륭합니다.
다만 **핵심 한 가지**가 잘못됐어요: 지금 사용하신 `wilcoxon()`은 **대응표본(짝지어진 자료)** 에 쓰는 검정입니다. 남/여는 **서로 독립인 두 집단**이므로 Wilcoxon **부호-순위 검정**이 아니라 **순위합 검정**(= Mann–Whitney U)을 써야 합니다.

---

#### 채점

* 가설 설정(양측): ✅
* 무작위 비복원 추출: ✅
* 정규성 검정(Shapiro): ✅ (p<.05 → 정규성 위배로 판단)
* 등분산성(Levene): ✅
* **검정 선택**: ❌

  * `stats.wilcoxon(r_male, r_female)` → **부적절** (대응표본용)
  * 올바른 비모수 독립 2표본 검정은 `stats.mannwhitneyu()`
* t-검정 결과 보고: △

  * 정규성 위배 시 t-검정은 참고로 보고할 수 있으나, 주검정으로는 비모수 권장

**총평: B (논리 흐름은 좋으나 검정 선택 1곳 오류)**

---

## 왜 Wilcoxon(부호-순위)은 안 되는가?

* `scipy.stats.wilcoxon`은 **같은 사람의 전/후**처럼 *쌍을 이루는* 데이터의 **차이의 중앙값**이 0인지 검정합니다.
* 지금은 남/여 **서로 다른 개체**들이라 **독립 표본**입니다.
* 독립 표본의 비모수 검정은 **Mann–Whitney U**(= Wilcoxon rank-sum)입니다.

---

#### 올바른 비모수 검정 (Mann–Whitney U) 예시

```python
from scipy import stats
import numpy as np, random

random.seed(23)
r_male   = random.sample(male,   15)
r_female = random.sample(female, 15)

u_stat, p_u = stats.mannwhitneyu(r_male, r_female, alternative='two-sided')
print(f"Mann–Whitney U={u_stat:.1f}, p={p_u:.5f}")

# 효과크기(Cliff's delta 또는 rank-biserial)
n1, n2 = len(r_male), len(r_female)
rank_biserial_r = 1 - 2*u_stat/(n1*n2)      # 또는 Cliff's delta = 2*u/(n1*n2) - 1
cliffs_delta = 2*u_stat/(n1*n2) - 1
print(f"rank-biserial r={rank_biserial_r:.3f}, Cliff's delta={cliffs_delta:.3f}")
```

* **해석 가이드**

  * p ≥ .05 → “유의한 차이를 **보이지 않는다**(귀무가설 기각 못함)”
  * 효과크기까지 함께 보고(예: Cliff’s δ)하면 좋습니다.

---

#### 선택 전략(권장 절차)

1. **정규성**: Shapiro + QQ-plot(시각 점검)
2. **등분산**: Levene
3. **검정 선택**

   * 정규성 위배(또는 이상치/왜도 강함) → **Mann–Whitney U**
   * 정규성 ok

     * 등분산 ok → **독립 2표본 t-검정 (equal\_var=True)**
     * 등분산 X → **Welch t-검정 (equal\_var=False)**
4. **보조 접근(선택)**

   * 로그 변환 후 t-검정
   * 로버스트 요약(중앙값, IQR) 병행 보고
5. **보고**

   * 통계량, p-value, 신뢰구간(가능하면), **효과크기**(Cohen’s d 혹은 Cliff’s δ)

---

#### 현재 결과의 해석(당신 코드 기준)

* Shapiro: 두 집단 모두 p<.05 → **정규성 위배**
* Levene: p>.05 → 등분산성은 **기각 못함**
* `mannwhitneyu`로 재검정했을 때의 p값이 **유의하지 않다면**
  → “성별에 따른 콜레스테롤 분포에 **유의한 차이가 있다고 보기 어려움**(귀무가설 기각 못함)”
* t-검정 p=.833도 같은 결론을 뒷받침(참고)

> 용어 주의: “채택”보다는 **‘기각하지 못했다’** 가 정확한 표현입니다.

---

#### 논문식 서술 예시(비모수 주검정)

> **방법** — 남녀 각각 15명을 무작위 비복원 추출하였다. 정규성 검정(Shapiro–Wilk)에서 두 집단 모두 정규성 가정을 기각하였으므로(p<.05), 독립 2표본에 대한 비모수 검정인 Mann–Whitney U 검정을 실시하였다.
> **결과** — U=…, p=…로, 성별에 따른 콜레스테롤 분포 차이는 통계적으로 유의하지 않았다(α=.05). 보조적으로 실시한 t-검정에서도 유의하지 않았다(t(28)=…, p=…). 효과크기는 Cliff’s δ=…로, 실제 차이의 크기도 작\~중간 수준이었다.
> **결론** — 본 표본에서는 성별에 따른 콜레스테롤 분포의 유의한 차이를 확인하지 못했다.

---

#### 한 줄 결론

* 흐름은 매우 좋았고, **검정 선택만 Mann–Whitney U로 교체**하면 완벽합니다.
* 결과 보고 시에는 **효과크기**까지 곁들이면 보고서/논문 품질이 확 올라갑니다.

---

## 문제3 피드백

- db서버 : 불특정 다수의 사람들이 공유하는 것이다.
	- sql 문장을 자주 쓰면 생산성이 떨어진다. 최소한으로 접근해야 한다.
	- 되도록 한 번에 필요한 데이터를 로컬로 끌고 온다.





