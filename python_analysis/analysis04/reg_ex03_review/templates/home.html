<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>home</title>
</head>
<body>
    <h2>회귀분석 문제4</h2>
    <hr>
    {{error}}
    {% csrf_token %}
    <form action="/result/" method="post" id="workyearForm">
        <label for="workyear">근속년수</label>
        <input type="text" name="workyear" id="workyear" value="" placeholder="근속년수 입력">
        <button type="submit">확인</button>
    </form>
    <div>
        <p id="expectedPay">예상연봉액 : {{ expectedPay_result | default:" "}}</p>
        <p id="r2">설명력 : {{ r2_result | default:" "}}</p>
        <p id="jobPays">{{ jobPays | safe }}</p>
    </div>
    <hr>
<!-- ajax -->
<script>
    const form = document.getElementById('workyearForm');
    const expectedPayDiv = document.getElementById('expectedPay');
    const r2Div = document.getElementById('r2');
    if (!form) return;

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const fd = new FormData(form); // workyear 포함

        fetch('/result/', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'X-CSRFToken': csrfToken
                // Content-Type 생략: FormData가 boundary 포함해 자동 설정
            },
            body: fd
        })
        .then(function(res) {
            if (!res.ok) throw new Error('HTTP ' + res.status);
            return res.json();
        })
        .then(function(data) {
            if (typeof data.expectedpay_result !== 'undefined') {
                expectedPayDiv.innerText = '예상연봉액 : ' + Number(data.expectedpay_result).toLocaleString() + ' 만원';
            }
            if (typeof data.r2_result !== 'undefined') {
                r2Div.innerText = '설명력 : ' + Number(data.r2_result).toFixed(2) + ' %';
            }
        })
        .catch(function(err) {
            console.error(err);
            expectDiv.innerText = '예상연봉액 : (요청 실패)';
            r2Div.innerText = '설명력 : (요청 실패)';
        });
    });
</script>
</body>
</html>